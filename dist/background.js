const l=async()=>new Promise((s,o)=>{chrome.storage.local.get("sites_chrome_storage_id",function(e){if(chrome.runtime.lastError)o(chrome.runtime.lastError);else{const r=e.sites_chrome_storage_id?e.sites_chrome_storage_id.toLowerCase().split(`
`):[];s(r)}})}),u=async()=>new Promise((s,o)=>{chrome.storage.local.get("queries_chrome_storage_id",function(e){if(chrome.runtime.lastError)o(chrome.runtime.lastError);else{const r=new Set(e.queries_chrome_storage_id?e.queries_chrome_storage_id.toLowerCase().split(`
`):[]);s(r)}})}),c=async()=>{const s=await l(),e=(await chrome.declarativeNetRequest.getDynamicRules()).map(r=>r.id);chrome.declarativeNetRequest.updateDynamicRules({addRules:s.filter(r=>r!="").map((r,t)=>({id:t+1,action:{type:"block"},condition:{urlFilter:r,resourceTypes:["main_frame"]}})),removeRuleIds:e},()=>console.log("Blocking rules added."))};c();chrome.tabs.onUpdated.addListener((s,o,e)=>{if(o.status==="complete"&&e.url)if(e.url.includes("https://www.bing.com/search")){const a=`https://www.google.com/search${new URL(e.url).search}`;chrome.tabs.update(s,{url:a})}else e.url.includes("google.com/search")&&u().then(r=>{const t=new URL(e.url||""),n=(new URLSearchParams(t.search).get("q")||"").split(" ");for(const i of n)r.has(i.toLowerCase())&&chrome.tabs.update(s,{url:"https://www.google.com/search"})})});chrome.runtime.onMessage.addListener(s=>{s.action==="refreshBlockingRules"&&c()});
