const l=async()=>new Promise((o,s)=>{chrome.storage.local.get("domains_chrome_storage_id",function(e){if(chrome.runtime.lastError)s(chrome.runtime.lastError);else{const r=e.domains_chrome_storage_id?e.domains_chrome_storage_id.toLowerCase().split(`
`):[];o(r)}})}),m=async()=>new Promise((o,s)=>{chrome.storage.local.get("queries_chrome_storage_id",function(e){if(chrome.runtime.lastError)s(chrome.runtime.lastError);else{const r=new Set(e.queries_chrome_storage_id?e.queries_chrome_storage_id.toLowerCase().split(`
`):[]);o(r)}})}),c=async()=>{const o=await l(),e=(await chrome.declarativeNetRequest.getDynamicRules()).map(r=>r.id);chrome.declarativeNetRequest.updateDynamicRules({addRules:o.filter(r=>r!="").map((r,t)=>({id:t+1,action:{type:"block"},condition:{urlFilter:r,resourceTypes:["main_frame"]}})),removeRuleIds:e},()=>console.log("Blocking rules added."))};c();chrome.tabs.onUpdated.addListener((o,s,e)=>{if(s.status==="complete"&&e.url)if(e.url.includes("https://www.bing.com/search")){const a=`https://www.google.com/search${new URL(e.url).search}`;chrome.tabs.update(o,{url:a})}else e.url.includes("google.com/search")&&m().then(r=>{const t=new URL(e.url||""),n=(new URLSearchParams(t.search).get("q")||"").split(" ");for(const i of n)r.has(i.toLowerCase())&&chrome.tabs.update(o,{url:"https://www.google.com/search"})})});chrome.runtime.onMessage.addListener(o=>{o.action==="refreshBlockingRules"&&c()});
